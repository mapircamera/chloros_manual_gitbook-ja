# 画像レイヤー

Chloros イメージビューアーの「画像レイヤー」ドロップダウンでは、同一画像の異なるバージョン（元のキャプチャ画像から処理済み反射率出力、計算済みインデックス画像まで）を素早く切り替えることができます。

## 画像レイヤーとは？

Chlorosにおいて、**レイヤー**とは単一ソース画像に対して利用可能な異なる画像出力を指します。画像処理を行う際、Chlorosは複数のバージョンを生成します：

* **オリジナル画像**（カメラからのJPGおよびRAWファイル）
* **反射率キャリブレーション済み**出力（反射率キャリブレーションが有効な場合）
* **ターゲット画像**（画像にキャリブレーションターゲットが含まれる場合）
* **インデックス画像**（NDVI、NDRE、GNDVIなど、インデックスが設定されている場合）

画像ビューアー右上の**レイヤー選択ドロップダウン**を使用すると、ビューアーを離れることなくこれらのバージョンを瞬時に切り替えられます。

***

## 利用可能なレイヤータイプ

### JPG

* カメラからのオリジナルJPGプレビュー画像
* 全画像で常に利用可能
* カメラでキャプチャされたままの未処理状態
* 読み込みと表示が最速

**表示タイミング:**

* オリジナル撮影画像の簡易プレビュー
* 構図やフレーミングの確認
* 処理前の撮影品質検証

### RAW（オリジナル）

* カメラからのオリジナルRAWセンサーデータ
* デベイヤー処理済み（後処理未適用）
* JPGより高いビット深度（通常12ビットまたは14ビットのセンサーデータ）

**表示の適した場面:**

* オリジナルセンサーデータの品質検査
* センサーの問題やアーティファクトの確認
* 処理前後の結果比較

### RAW (ターゲット)

* キャリブレーションターゲットを含むと識別された画像でのみ表示
* ターゲットが検出された元のRAW画像を表示
* ターゲット検出の成功確認に使用

**表示タイミング:**

* キャリブレーションターゲットが正しく検出されたか確認
* ターゲット画像の品質チェック
* キャリブレーション問題のトラブルシューティング

{% hint style=&quot;info&quot; %}
**ターゲットレイヤー**: このレイヤーは、キャリブレーションターゲットを含む画像のドロップダウンにのみ表示されます。通常のキャプチャ画像にはこのオプションはありません。
{% endhint %}

### RAW (反射率)

* キャリブレーション済み反射率出力画像
* ヴィネット補正済み（処理で有効化されている場合）
* ターゲットデータによる反射率キャリブレーション済み（有効化されている場合）
* マルチバンド TIFF（全カメラチャンネル）
* ピクセル値はパーセント反射率を表す（パーセントモード使用時）
* [インデックス/LUTサンドボックス]で操作可能(index-lut-sandbox.md)

**表示タイミング:**

* 校正結果の確認
* 校正品質の検証
* 科学的精度のためのピクセル値チェック
* 校正効果確認のためのオリジナル画像との比較

{% hint style=&quot;success&quot; %}
**推奨**: 科学的な測定や分析のためのピクセル値確認には、RAW（反射率）レイヤーを使用してください。
{% endhint %}

### RAW（NDVI インデックス）...および類似項目

* 計算された植生指数画像 (この例ではNDVI)
* 処理時に設定された指数に基づいて指数名が変更されます
* 例: RAW (NDVI指数)、RAW (NDRE指数)、RAW (GNDVI指数) など
* インデックス計算結果を示す単一バンドグレースケール画像
* プロジェクト設定で構成されたインデックスごとに1つのレイヤーが表示される

**可能なインデックス名:**

* RAW (NDVI インデックス)
* RAW (NDRE インデックス)
* RAW (GNDVI インデックス)
* RAW (OSAVI インデックス)
* RAW (EVI インデックス)
* RAW (SAVI インデックス)
* その他多数... ([マルチスペクトルインデックス計算式](../project-settings/multispectral-index-formulas.md) 参照)

**表示タイミング:**

* インデックス計算結果の確認
* インデックス値範囲のチェック
* 関心領域の特定
* GISや解析での使用前のインデックス画像検証

***

## レイヤーセレクターの使用方法

### ドロップダウンの表示

1. 画像を全画面モードで開く （画像ビューアーのサムネイルをクリック）
2. ビューアー右上の**レイヤードロップダウン**を探す
3. ドロップダウンには現在選択中のレイヤー（例：「JPG」）が表示される
4. ドロップダウンをクリックすると全利用可能レイヤーが表示される

### レイヤーの切り替え

1. レイヤードロップダウンをクリックしてリストを開く
2. 現在の画像で利用可能な全レイヤーが表示される
3. 任意のレイヤー名をクリックするとそのバージョンに切り替わります
4. 画像は即座に更新され、選択したレイヤーが表示されます

**クイック切り替え:**

* ドロップダウンは前回の選択を記憶します
* 次の画像に移動する際、Chlorosは同じレイヤータイプを表示しようとします
* 次の画像にそのレイヤーが存在しない場合、デフォルトでJPGが表示されます

### レイヤーの可用性

すべての画像で全てのレイヤーが利用可能なわけではありません：

**常に利用可能：**

* ✅ JPG（全画像にJPGプレビューあり）

**条件付きで利用可能：**

* ⚠️ RAW（オリジナル） - 画像がRAWまたはRAW+JPGモードで撮影された場合のみ
* ⚠️ RAW（ターゲット） - 画像に検出されたキャリブレーションターゲットが含まれる場合のみ
* ⚠️ RAW (反射率) - 反射率キャリブレーションを有効にして処理後のみ利用可能
* ⚠️ RAW (\[インデックス] インデックス) - インデックス設定で処理後のみ利用可能

***

## レイヤーの持続性

### 画像間の移動

別の画像に移動する場合（矢印キーまたはサムネイルクリック時）：

**レイヤー設定は保持されます:**

* 「RAW (反射率)」を表示中の場合、次の画像も「RAW (反射率)」を表示（利用可能な場合）
* 「RAW (NDVI インデックス)」を表示中の場合、次の画像も「RAW (NDVI インデックス)」を表示（利用可能な場合）
* 同一レイヤーが存在しない場合、デフォルトでJPGを表示

**ワークフロー例:**

1. 画像1を開き、RAW (NDVI インデックス) に切り替える
2. →を押して画像2を表示
3. 画像2は自動的にRAW (NDVI インデックス) レイヤーを表示
4. ナビゲーションを継続 - 全画像に NDVI レイヤーが表示
5. 複数画像のインデックス結果を効率的にレビュー可能

***

## 一般的なワークフロー

### ワークフロー 1: 比較前/後

**目的**: オリジナル画像とキャリブレーション済み画像の比較

1. 処理済み画像を Image Viewer で開く
2. ドロップダウンから**RAW (オリジナル)**を選択
3. ビネット効果と未校正値を確認
4. ドロップダウンから**RAW (反射率)**に切り替え
5. 比較 - ビネット除去済み、値が校正済み

### ワークフロー 2: インデックスレビュー

**目的**: データセット全体のNDVI結果を迅速にレビュー

1. 最初の処理済み画像を開く
2. ドロップダウンから**RAW (NDVI インデックス)**を選択
3. →矢印キーで次の画像に移動
4. NDVIレイヤーは自動的に保持
5. 全画像を通じ、NDVIパターンを確認しながら継続
6. **RAW (XPROTXインデックス)**に切り替えて比較

### ワークフロー3: ターゲット検証

**目的**: 全ターゲット画像が正しく検出されていることを確認

1. ターゲット画像に移動
2. ドロップダウンから**RAW (ターゲット)**を選択
3. キャリブレーションターゲットが明瞭に視認・検出されていることを確認
4. 次のターゲット画像に移動
5. 全ターゲットで検証を繰り返す

### ワークフロー4: ピクセル値検査

**目的**: 科学的正確性のため反射率値を確認

1. 処理済み画像を開く
2. **RAW (反射率)** レイヤーを選択
3. **ピクセルパーセント**モードを有効化（右上ツールバーのボタン）
4. 植生領域にカーソルを移動
5. ピクセル値が想定範囲内であることを確認（NIR: 30-70%、Red: 5-15%）
6. 土壌・水域の適切な値を確認

***

## レイヤー別ピクセル値の理解

レイヤーごとに異なるピクセル値範囲を表示:

### JPGレイヤー

* **範囲**: 0-255 (8ビット)
* **意味**: 表示値（ガンマ補正済み）
* **用途**: 視覚的確認のみ（科学的な測定には不適）

### RAW（オリジナル）

* **範囲**: 0-65535 (16ビット)
* **意味**: センサーの生のデジタル数値
* **用途**: センサー性能の確認用（キャリブレーションなし）

### RAW（反射率）

* **範囲**: 0-65,535 (16ビット TIFF) または 0.0-1.0 (32ビット パーセント)
* **意味**: 校正済みパーセント反射率
* **用途**: 科学的な測定と分析

**16ビット TIFF の場合:** 65,535 で割るとパーセント反射率が得られる
**32ビット Percent の場合:** 値が直接パーセントを表す (0.5 = 50% 反射率)

### RAW（インデックス画像）

* **範囲**: インデックスにより異なる（正規化インデックスでは通常 -1.0 ～ +1.0）
* **意味**: インデックス計算結果
* **例**:
  * NDVI: -1 ～ +1（植生は通常 0.4 ～ 0.9）
  * NDRE: -1～+1（ストレス検出）
  * EVI: 0～1（強化植生）

***

## ヒントとベストプラクティス

### 効率的なレイヤー切り替え

* **キーボードショートカットの活用**: レイヤー専用のショートカットはありませんが、ナビゲーション矢印キー（←/→）で全レイヤー間を移動可能
* **一貫したワークフロー**: 1つのレイヤー（例: NDVI）を選択し、データセット全体を確認してから別のレイヤーに切り替える
* **迅速な比較**: 処理品質を確認するため、オリジナルと反射率レイヤーを切り替えて比較

### パフォーマンスに関する考慮事項

* **JPGが最速で読み込み**：多数の画像を素早くナビゲートする場合に使用
* **RAWレイヤーは読み込みが遅い**：高解像度かつ高ビット深度
* **インデックスレイヤー**：反射率レイヤーと同等の速度
* **初回読み込みが最も遅い**：同一レイヤーの次回以降表示はキャッシュされ高速化

### 品質検証

* **必ずRAW（オリジナル）を確認**：処理済み出力の信頼前にソースデータ品質を検証
* **レイヤー比較**：レイヤー切り替えで処理の正常性を検証
* **インデックス範囲確認**：インデックスレイヤーでピクセルパーセントモードを使用し値の妥当性を検証

***

## トラブルシューティング

### レイヤーが利用不可

**問題**: 期待したレイヤーがドロップダウンに表示されない

**考えられる原因:**

* 画像が処理されていない（JPGとRAW（オリジナル）のみ利用可能）
* 処理中に反射率キャリブレーションが無効化されていた
* プロジェクト設定で特定のインデックスが設定されていない
* 画像がターゲット専用画像である （ターゲットにはインデックスが生成されない）

**解決策:**

1. 画像が処理済みか確認（出力フォルダに処理済みファイルがあるか確認）
2. プロジェクト設定でインデックスが設定されているか確認
3. 必要なインデックスを有効にして再処理

### 誤ったレイヤーが表示される

**問題**: 予期しないレイヤーで画像が開く

**原因**: 前の画像のレイヤー設定が引き継がれたが、現在の画像にそのレイヤーが存在しない

**解決策**: Chlorosは優先レイヤーが利用不可の場合、自動的にJPGにフォールバックします - これは正常な動作です

### キャリブレーションターゲットが表示されない

**問題**: RAW（ターゲット）レイヤーにターゲット検出が表示されない

**考えられる原因:**

* 処理中にターゲットが検出されなかった
* 画像に実際にターゲットが含まれていない
* ターゲット検出設定が厳しすぎる

**解決策:**

1. デバッグログで「ターゲット検出」メッセージを確認
2. 画像に実際に視認可能なキャリブレーションターゲットが含まれているか確認
3. プロジェクト設定でターゲット検出設定を調整
4. [ターゲット画像の選択]を参照(../processing-images-gui/choosing-target-images.md)

***

## 関連機能

### 画像ビューアツール

レイヤー表示時に以下の操作が可能です：

* **ズーム操作**：拡大して詳細を確認
* **パン**：クリック＆ドラッグで拡大画像内を移動
* **ピクセル値確認**：カーソル位置の値を表示
* **ナビゲーション矢印**：レイヤーを維持したまま画像間を移動
* **ピクセルパーセントモード**：DN表示とパーセント表示を切り替え

画像ビューアの完全なドキュメントについては[画像の全画面表示](opening-an-image-full-screen.md)を参照してください。

### インデックス/LUTサンドボックス

インタラクティブなインデックステストと可視化:

* **リアルタイムインデックス計算**: 様々なインデックス計算式をテスト
* **LUTカラーマッピング**: グレースケールインデックスにカラーグラデーションを適用
* **可視化データのエクスポート**: カラー化されたインデックス画像を保存

詳細は[インデックス/LUTサンドボックス](index-lut-sandbox.md)を参照。

***

## 次のステップ

画像レイヤーの理解が深まったら：

* [**画像のフルスクリーン表示**](opening-an-image-full-screen.md) - 完全なイメージビューアーガイド
* [**インデックス/LUTサンドボックス**](index-lut-sandbox.md) - インタラクティブなインデックス可視化
* [**マルチスペクトル指数計算式**](../project-settings/multispectral-index-formulas.md) - 利用可能な指数リファレンス
* [**処理の完了**](../processing-images-gui/finishing-the-processing.md) - 処理済み出力の理解
