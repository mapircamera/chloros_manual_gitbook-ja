# 処理の監視

処理が開始されると、Chlorosは進捗の監視、問題の確認、データセットの状態把握のための複数の方法を提供します。このページでは、処理の追跡方法とChlorosが提供する情報の解釈方法を説明します。

## 進捗バーの概要

上部ヘッダーの進捗バーは、リアルタイムの処理状況と完了率を表示します。

### 無料モードの進捗バー

Chloros+ ライセンスをお持ちでないユーザー向け：

**2段階の進捗表示：**

1. **ターゲット検出** - 画像内のキャリブレーションターゲットの検出
2. **処理** - 補正の適用とエクスポート

**プログレスバー表示内容：**

* 総合完了率（0-100%）
* 現在の段階名
* 簡易水平バー表示

### Chloros+ プログレスバー

Chloros+ ライセンス保有ユーザー向け：

**4段階進捗表示：**

1. **検出** - キャリブレーションターゲットの探索
2. **解析** - 画像の検証と処理パイプラインの準備
3. **キャリブレーション** - ビネット補正と反射率補正の適用
4. **エクスポート** - 処理済みファイルの保存

**インタラクティブ機能:**

* 進捗バーに**カーソルを合わせる**と4段階パネルが展開表示
* **クリック** で展開パネルを固定/ピン留め
* **再度クリック** で固定解除、マウス離しで自動非表示
* 各段階の個別進捗表示 (0-100%)

***

## 各処理段階の解説

### 段階1: 検出 (ターゲット検出)

**処理内容:**

* Chlorosがターゲットチェックボックス付き画像をスキャン
* コンピュータビジョンアルゴリズムが4つのキャリブレーションパネルを識別
* 各パネルから反射率値を抽出
* 正確なキャリブレーションスケジュールのためターゲットタイムスタンプを記録

**所要時間:**

* ターゲットマークあり: 10～60秒
* ターゲットマークなし: 5～30分以上（全画像スキャン）

**進捗インジケーター:**

* 検出中: 0% → 100%
* スキャン済み画像数
* 検出済みターゲット数

**確認事項:**

* ターゲットが正しくマークされていれば迅速に完了する
* 時間がかかりすぎる場合、ターゲットがマークされていない可能性がある
* デバッグログで「ターゲット検出」メッセージを確認

### ステージ2: 分析

**処理内容:**

* 画像のEXIFメタデータ（タイムスタンプ、露出設定）を読み取り
* ターゲットのタイムスタンプに基づきキャリブレーション戦略を決定
* 画像処理キューを整理
* 並列処理ワーカーの準備（Chloros+のみ）

**所要時間:** 5～30秒

**進行状況インジケーター:**

* 分析中: 0% → 100%
* 高速ステージ、通常は短時間で完了

**確認事項:**

* 停止なく着実に進行するべき
* メタデータ欠落に関する警告はデバッグログに表示

### ステージ3: キャリブレーション

**処理内容:**

* **デベイヤー処理**: RAWベイヤーパターンを3チャンネルに変換
* **ヴィネット補正**: レンズ周辺部の暗化を除去
* **反射率キャリブレーション**: 目標値で正規化
* **インデックス計算**: マルチスペクトルインデックスを算出
* 全画像をフルパイプラインで処理

**所要時間:** 総処理時間の大半 (60-80%)

**進行状況インジケーター:**

* キャリブレーション中: 0% → 100%
* 現在処理中の画像
* 完了画像数 / 総画像数

**処理動作:**

* **フリーモード**: 画像を1枚ずつ順次処理
* **Chloros+モード**: 最大16枚を同時処理
* **GPUアクセラレーション**: この段階を大幅に高速化

**確認事項:**

* 画像数の着実な進行
* デバッグログで画像ごとの完了メッセージを確認
* 画像品質やキャリブレーション問題に関する警告

### ステージ4: エクスポート

**処理内容:**

* 選択した形式でキャリブレーション済み画像をディスクに書き込み
* LUTカラー付きマルチスペクトルインデックス画像をエクスポート
* カメラモデル別サブフォルダを作成
* 適切なサフィックス付きで元のファイル名を保持

**所要時間:** 総処理時間の10～20%

**進捗インジケーター:**

* エクスポート: 0% → 100%
* 書き込み中のファイル
* エクスポート形式と保存先

**確認事項:**

* ディスク容量警告
* ファイル書き込みエラー
* 設定済み出力の全完了

***

## デバッグログタブ

デバッグログは処理の進捗状況や発生した問題に関する詳細情報を提供します。

### デバッグログへのアクセス

1. 左サイドバーの**デバッグログ** <img src="../.gitbook/assets/icon_log.JPG" alt="" data-size="line"> アイコンをクリック
2. リアルタイム処理メッセージを表示するログパネルが開く
3. 最新メッセージを表示するため自動スクロール

### ログメッセージの理解

#### 情報メッセージ（白/灰色）

通常の処理更新:

```
[INFO] Processing started
[INFO] Target detected in IMG_0015.RAW - 4 panels found
[INFO] Calibrating IMG_0234.RAW
[INFO] Exported NDVI image: IMG_0234_NDVI.tif
[INFO] Processing complete
```

#### 警告メッセージ（黄色）

処理を停止しない非重大な問題：

```
[WARN] No GPS data found in IMG_0145.RAW
[WARN] Target image timestamp gap > 30 minutes
[WARN] Low contrast in calibration panel - results may vary
```

**対応：** 処理後に警告を確認するが、中断しない

#### エラーメッセージ (Red)

処理失敗の原因となる重大な問題：

```
[ERROR] Cannot write file - disk full
[ERROR] Corrupted image file: IMG_0299.RAW
[ERROR] No targets detected - enable reflectance calibration or mark target images
```

**対応:** 処理を停止し、エラーを解決して再起動

### 一般的なログメッセージ

| メッセージ                          | 意味                                 | 必要な対応                                         |
| -------------------------------- | -------------------------------------- | ----------------------------------------------------- |
| &quot;\[ファイル名\]でターゲットを検出&quot; | キャリブレーションターゲットを正常に検出 | 不要 - 正常 |
| &quot;Y枚中X枚目の画像を処理中&quot;        | 現在の進捗更新                 | 不要 - 正常 |
| &quot;ターゲットが見つかりません&quot;      | キャリブレーションターゲットを検出せず | ターゲット画像をマークするか反射率キャリブレーションを無効化 |
| &quot;ディスク容量不足&quot;             | 出力用ストレージ不足                  | ディスク容量を解放                                    |
| &quot;破損ファイルをスキップ&quot;         | 画像ファイルが損傷                   | SDカードからファイルを再コピー                             |
| &quot;PPKデータ適用&quot;               | .daqファイルからのGPS補正を適用 | なし - 正常                                         |

### ログデータのコピー

トラブルシューティングやサポート用にログをコピーするには：

1. デバッグログパネルを開く
2. **「ログをコピー」**ボタンをクリック（または右クリック → 全選択）
3. テキストファイルまたはメールに貼り付ける
4. 必要に応じてMAPIRサポートに送信

***

## システムリソース監視

### CPU使用率

**フリーモード:**

* 1つのCPUコアが\~100%
* 他のコアはアイドル状態または利用可能
* システムは応答性を維持

**Chloros+ 並列モード:**

* 複数のコアが80-100%（最大16コア）
* 全体的なCPU使用率が高い
* システムの応答性が低下する場合あり

**監視方法:**

* Windows タスクマネージャー (Ctrl+Shift+Esc)
* パフォーマンスタブ → CPUセクション
* 「Chloros」または「chloros-backend」プロセスを確認

### メモリ(RAM)使用率

**標準的な使用量:**

* 小規模プロジェクト（100枚未満の画像）：2～4 GB
* 中規模プロジェクト（100～500枚の画像）：4～8 GB
* 大規模プロジェクト（500枚以上の画像）：8～16 GB
* Chloros+ 並列モードではより多くのRAMを使用

**メモリ不足の場合:**

* 処理バッチを小さくする
* 他のアプリケーションを閉じる
* 大規模データセットを定期的に処理する場合はRAMを増設する

### GPU使用量（CUDA搭載のChloros+）

GPUアクセラレーション有効時:

* NVIDIA GPUの利用率が高くなる（60-90%）
* VRAM使用量が増加（4GB以上のVRAMが必要）
* キャリブレーション段階が大幅に高速化

**監視方法：**

* NVIDIAシステムトレイアイコン
* タスクマネージャー → パフォーマンス → GPU
* GPU-Zなどの監視ツール

### ディスクI/O

**想定される動作：**

* 解析段階でディスク読み取りが急増
* エクスポート段階でディスク書き込みが急増
* SSDはHDDより大幅に高速

**パフォーマンス向上策:**

* プロジェクトフォルダは可能な限りSSDを使用
* 大容量データセットのネットワークドライブ使用を回避
* ディスク容量が限界に近づいていないことを確認（書き込み速度に影響）

***

## 処理中の問題検出

### 警告サイン

**処理が停止する（5分以上変化なし）：**

* デバッグログでエラーを確認
* ディスク空き容量を検証
* タスクマネージャーでChlorosが実行中か確認

**エラーメッセージが頻繁に表示される：**

* 処理を停止しエラーを確認
* 一般的な原因：ディスク容量不足、ファイル破損、メモリ問題
* 下記トラブルシューティングセクションを参照

**システムが応答しなくなる場合：**

* Chloros+ 並列モードがリソースを過剰に消費
* 同時実行タスクの削減またはハードウェアのアップグレードを検討
* フリーモードはリソース消費が少ない

### 処理を停止すべきタイミング

以下の現象が発生した場合、処理を停止してください：

* ❌ 「ディスク容量不足」または「ファイル書き込み不可」エラー
* ❌ 画像ファイル破損エラーが繰り返し発生
* ❌ システムが完全にフリーズ（応答なし）
* ❌ 設定ミスに気付いた
* ❌ 誤った画像をインポートした

**停止方法:**

1. **停止/キャンセルボタン**をクリック（開始ボタンの代わり）
2. 処理が停止し、進行状況は失われます
3. 問題を修正し、最初から再実行してください

***

## 処理中のトラブルシューティング

### 処理が非常に遅い場合

**考えられる原因:**

* 対象画像が未指定（全画像のスキャン）
* SSDではなくHDDストレージの使用
* システムリソース不足
* 設定されたインデックス数が多すぎる
* ネットワークドライブへのアクセス

**解決策:**

1. 処理開始直後で検出段階の場合：キャンセル→対象画像を選択→再起動
2. 今後対策：SSDの使用、インデックス削減、ハードウェアのアップグレード
3. 大規模データセットのバッチ処理にはCLIの使用を検討

### 「ディスク容量不足」警告

**解決策：**

1. 直ちにディスク容量を解放
2. プロジェクトを空き容量の多いドライブに移動
3. エクスポートするインデックス数を減らす
4. TIFFの代わりにJPG形式を使用（ファイルサイズが小さい）

### 頻繁な「ファイル破損」メッセージ

**解決策:**

1. 完全性を確保するためSDカードから画像を再コピー
2. SDカードのエラーをテスト
3. プロジェクトから破損ファイルを削除
4. 残りの画像の処理を継続

### システムの過熱／スロットリング

**解決策：**

1. 十分な換気を確保する
2. コンピュータの通気口からほこりを除去する
3. 処理負荷を軽減する（Chloros+の代わりにFreeモードを使用）
4. 1日のうち涼しい時間帯に処理を行う

***

## 処理完了通知

処理が終了すると：

* 進捗バーが100%に達する
* デバッグログに**「処理完了」**メッセージが表示される
* 開始ボタンが再び有効になる
* 全出力ファイルがカメラモデルサブフォルダ内に存在する

***

## 次に取るべき手順

処理完了後：

1. **結果の確認** - [処理の終了](finishing-the-processing.md)を参照
2. **出力フォルダを確認** - 全てのファイルが正しくエクスポートされていることを確認
3. **デバッグログを確認** - 警告やエラーがないかチェック
4. **処理済み画像をプレビュー** - イメージビューアまたは外部ソフトウェアを使用

処理結果の確認と使用方法については、[処理の完了](finishing-the-processing.md)を参照してください。
