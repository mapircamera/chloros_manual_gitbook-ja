# プロジェクト設定

プロジェクト設定 <img src="../.gitbook/assets/icon_project-settings.JPG" alt="" data-size="line"> Chlorosのサイドバーでは、画像処理、キャリブレーションターゲット検出、マルチスペクトルインデックス計算、およびプロジェクトのエクスポートオプションに関するあらゆる側面を設定できます。これらの設定はプロジェクトと共に保存され、複数のプロジェクトで再利用可能なテンプレートとして保存することもできます。

## プロジェクト設定へのアクセス

プロジェクト設定にアクセスするには：

1. Chlorosでプロジェクトを開く
2. 左サイドバーの**プロジェクト設定**  <img src="../.gitbook/assets/icon_project-settings.JPG" alt="" data-size="line"> タブをクリックします
3. 設定パネルに、カテゴリ別に整理されたすべての設定オプションが表示されます

***

## ターゲット検出

これらの設定は、Chlorosが画像内のキャリブレーションターゲットを検出・処理する方法を制御します。

### 最小キャリブレーションサンプル領域 (px)

* **タイプ**: 数値
* **範囲**: 0 ～ 10,000 ピクセル
* **デフォルト**: 25 ピクセル
* **説明**: 検出領域が有効なキャリブレーションターゲットサンプルと見なされるために必要な最小面積（ピクセル単位）を設定します。値を小さくするとより小さなターゲットを検出できますが、誤検出が増加する可能性があります。値を大きくすると、検出にはより大きく明確なターゲット領域が必要になります。
* **調整のタイミング**:
  * 小さな画像アーティファクトで誤検出が発生する場合に増加
  * 画像内でキャリブレーションターゲットが小さく見え、検出されない場合に減少

### 最小ターゲットクラスタリング (0-100)

* **タイプ**: 数値
* **範囲**: 0 ～ 100
* **デフォルト**: 60
* **説明**: キャリブレーションターゲット検出時に、類似した色領域をグループ化するクラスタリング閾値を制御します。値が高いほど、より類似した色をグループ化する必要があり、ターゲット検出がより保守的になります。値が低いほど、ターゲットグループ内の色のばらつきが許容されます。
* **調整のタイミング**:
  * キャリブレーションターゲットが複数の検出に分割される場合、値を上げます
  * 色のばらつきがあるキャリブレーションターゲットが完全に検出されない場合、値を下げます

***

## 処理

これらの設定は、Chlorosが画像を処理・キャリブレーションする方法を制御します。

### ヴィネット補正

* **タイプ**: チェックボックス
* **デフォルト**: 有効（チェック済み）
* **説明**: レンズの周辺光量落ちを補正するヴィネット補正を適用します。 ヴィネットは、レンズの特性により画像の隅や端が中央より暗く見える一般的な光学現象です。
* **無効化する場合**: カメラ/レンズの組み合わせで既にヴィネット補正が適用されている場合、または後処理で手動補正を行う場合にのみ無効化してください。

### 反射率キャリブレーション / ホワイトバランス

* **タイプ**: チェックボックス
* **デフォルト**: 有効 (チェック済み)
* **説明**: 画像内で検出されたキャリブレーションターゲットを用いた自動反射率キャリブレーションを有効化します。これによりデータセット全体の反射率値が正規化され、照明条件に関わらず一貫した測定が保証されます。
* **無効化する場合**: キャリブレーションされていない生の画像を処理する場合、または別のキャリブレーションワークフローを使用する場合にのみ無効化してください。

### デベイヤー処理方式

* **タイプ**: ドロップダウン選択
* **オプション**:
  * 高品質（高速） - 現在利用可能な唯一のオプション
* **デフォルト**: 高品質（高速）
* **説明**: ベイヤーパターンセンサーの生のデータをフルカラー画像に変換するデモザイクアルゴリズムを選択します。「高品質（高速）」方式は処理速度と画質の間で最適なバランスを提供します。
* **注記**: Chlorosの将来バージョンでは追加のデベイヤー方式が実装される可能性があります。

### 最小再キャリブレーション間隔

* **タイプ**: 数値
* **範囲**: 0～3,600秒
* **デフォルト**: 0秒
* **説明**: キャリブレーションターゲット使用間の最小時間間隔（秒単位）を設定します。0に設定すると、Chlorosは検出された全てのキャリブレーションターゲットを使用します。より高い値に設定すると、Chlorosはこの秒数以上間隔をあけたキャリブレーションターゲットのみを使用し、頻繁にキャリブレーションターゲットを撮影するデータセットの処理時間を短縮します。
* **調整のタイミング**:
  * 照明条件が変動する場合、最高精度でキャリブレーションを行うには0に設定
  * 照明が安定しておりキャリブレーションターゲット画像が頻繁にある場合、処理を高速化するには値を増加（例：60～300秒）

### 光センサーのタイムゾーンオフセット

* **タイプ**: 数値
* **範囲**: -12～+12時間
* **デフォルト**: 0時間
* **説明**: 光センサーデータタイムスタンプのタイムゾーンオフセット（UTCからの時間差）を指定します。PPK（後処理動的測位）データファイル処理時に、画像取得とGPSデータの正確な時刻同期を確保するために使用されます。
* **調整タイミング**: PPKデータがUTCではなく現地時間を使用する場合、現地のタイムゾーンオフセットを設定します。例:
  * 太平洋時間: -8 または -7 (夏時間による)
  * 東部時間: -5 または -4 (夏時間による)
  * 中央ヨーロッパ時間: +1 または +2 (夏時間による)

### PPK補正の適用

* **タイプ**: チェックボックス
* **デフォルト**: 無効 (未チェック)
* **説明**: GPS（GNSS）を搭載したMAPIR DAQレコーダーからの後処理動的測位（PPK）補正の使用を有効にします。有効にすると、Chlorosはプロジェクトディレクトリ内の露光ピンデータを含む.daqログファイルを使用し、画像に精密な地理位置補正を適用します。
* **要件**: プロジェクトディレクトリに露光ピンエントリを含む.daqログファイルが存在すること
* **有効化のタイミング**: .daqログファイルに露光フィードバックエントリがある場合は、常にPPK補正を有効にすることを推奨します。

### 露光ピン1

* **タイプ**: ドロップダウン選択
* **表示条件**: 「PPK補正を適用」が有効かつピン1の露光データが利用可能な場合のみ表示
* **オプション**:
  * プロジェクトで検出されたカメラモデル名
  * 「使用しない」 - この露光ピンを無視
* **デフォルト**: プロジェクト設定に基づき自動選択
* **説明**: PPK時間同期用に露光ピン1に特定のカメラを割り当てます。露光ピンはカメラシャッターが作動した正確なタイミングを記録し、正確なPPK位置測定に不可欠です。
* **自動選択動作**:
  * 単一カメラ + 単一ピン: カメラを自動選択
  * 単一カメラ + 2ピン: ピン1が自動的にカメラに割り当てられる
  * 複数カメラ: 手動選択が必要

### 露光ピン2

* **タイプ**: ドロップダウン選択
* **表示条件**: 「PPK補正を適用」が有効かつピン2の露光データが存在する場合にのみ表示
* **オプション**:
  * プロジェクト内で検出されたカメラモデル名
  * 「使用しない」 - この露出ピンを無視
* **デフォルト**: プロジェクト設定に基づき自動選択
* **説明**: デュアルカメラ構成時、PPK時間同期用に露出ピン2へ特定のカメラを割り当てます。
* **自動選択動作**:
  * 単一カメラ + 単一ピン: ピン2は自動的に「使用しない」に設定
  * 単一カメラ + 2ピン: ピン2は自動的に「使用しない」に設定
  * 複数カメラ: 手動選択が必要
* **注意**: 同一カメラをピン1とピン2に同時に割り当てることはできません。

***

## インデックス

これらの設定により、分析および可視化用のマルチスペクトル指数を構成できます。

### インデックスの追加

* **タイプ**: 特殊指数設定パネル
* **説明**: 画像処理中に計算するマルチスペクトル植生指数（NDVI、NDRE、EVIなど）を選択・設定できる対話型パネルを開きます。複数の指数を追加でき、それぞれに独自の可視化設定が可能です。
* **利用可能な指数**: システムには30以上の事前定義済みマルチスペクトル指数が含まれます。例:
  * NDVI (正規化差分植生指数)
  * NDRE (正規化差分RedEdge)
  * EVI（強化植生指数）
  * GNDVI、SAVI、OSAVI、MSAVI2
  * その他多数（完全なリストは[マルチスペクトル指数式](multispectral-index-formulas.md) 参照)
* **機能**:
  * 事前定義済み指数式からの選択
  * 可視化用カラーグラデーションの設定 (LUT - ルックアップテーブル)
  * 解析用しきい値の設定
  * カスタム指数式の作成

### カスタム式 (Chloros+ 機能)

* **タイプ**: カスタム式定義の配列
* **説明**: バンド演算を用いたカスタム多波長指数式を作成・保存可能。カスタム式はプロジェクト設定と共に保存され、組み込み指数と同様に使用できます。
* **作成方法**:
  1. 指数設定パネルでカスタム式オプションを探す
  2. バンド識別子（例: NIR, Red, Green, Blue）を使用して式を定義
  3. 説明的な名前で数式を保存
* **数式構文**: 以下の標準的な数学演算をサポート:
  * 算術演算: `+`, `-`, `*`, `/`
  * 演算順序のための括弧
  * バンド参照: NIR, Red, Green, Blue, RedEdge, Cyan, Orange, NIR1, NIR2

***

## エクスポート

これらの設定は、処理済み画像のエクスポート形式と品質を制御します。

### キャリブレーション済み画像形式

* **タイプ**: ドロップダウン選択
* **オプション**:
  * **TIFF (16ビット)** - 非圧縮16ビットTIFF形式
  * **TIFF (32ビット、パーセント)** - 反射率値をパーセントで表す32ビット浮動小数点TIFF
  * **PNG (8ビット)** - 圧縮8ビットPNG形式
  * **JPG (8ビット)** - 圧縮8ビットJPEG形式
* **デフォルト**: TIFF (16ビット)
* **説明**: 処理・キャリブレーション済み画像の保存用ファイル形式を選択します。
* **推奨フォーマット**:
  * **TIFF (16ビット)**: 科学分析やプロフェッショナルワークフローに推奨。 圧縮アーティファクトなしで最大のデータ品質を保持。マルチスペクトル解析やGISソフトウェアでのさらなる処理に最適。
  * **TIFF (32ビット、パーセント)**: 反射率値をパーセント（0-100%）で必要とするワークフローに最適。放射測定に最大限の精度を提供。
  * **PNG (8ビット)**: ウェブ閲覧や一般的な可視化に適しています。ロスレス圧縮によりファイルサイズが小さくなりますが、ダイナミックレンジが低下します。
  * **JPG (8ビット)**: 最小のファイルサイズで、プレビューやウェブ表示専用に最適です。ロス圧縮を使用するため、科学的な分析には適していません。

***

## プロジェクトテンプレートの保存

この機能により、現在のプロジェクト設定を再利用可能なテンプレートとして保存できます。

* **入力形式**: テキスト入力 + 保存ボタン
* **説明**: 設定テンプレートの説明的な名前を入力し、保存アイコンをクリックします。テンプレートには現在のプロジェクト設定（ターゲット検出、処理オプション、インデックス、エクスポート形式）がすべて保存され、将来のプロジェクトで簡単に再利用できます。
* **使用例**:
  * 異なるカメラシステム用テンプレート作成（例: RGB、マルチスペクトル、NIR）
  * 特定作物種や分析ワークフローの標準設定保存
  * チーム内での設定共有
* **使用方法**:
  1. 必要なプロジェクト設定をすべて構成
  2. テンプレート名を入力（例: &quot;RedEdge Survey3 NDVI 標準&quot;）
  3. 保存アイコンをクリック
  4. 新規プロジェクト作成時にテンプレートを読み込めるようになります

***

## プロジェクトフォルダ保存

この設定は、新規プロジェクトのデフォルト保存先を指定します。

* **タイプ**: ディレクトリパス表示 + 編集ボタン
* **デフォルト**: `C:\Users\[Username]\Chloros Projects`
* **説明**: 新規Chlorosプロジェクト作成時の現在のデフォルトディレクトリを表示します。編集アイコンをクリックして別のディレクトリを選択してください。
* **変更のタイミング**:
  * チーム共同作業用にネットワークドライブに設定
  * 大容量データセット用に空き容量の多いドライブに変更
  * 年別・クライアント別・プロジェクト種別でフォルダを整理
* **注意**: この設定変更は新規プロジェクトのみに影響します。既存プロジェクトは元の場所に残ります。

***

## 設定の永続性

すべてのプロジェクト設定はプロジェクトファイル（`.mapir` プロジェクト形式）と共に自動保存されます。プロジェクトを再開すると、設定は終了時の状態を完全に復元します。

### 設定の優先順位

設定は以下の順序で適用されます：

1. **システムデフォルト** - Chloros で定義された組み込みデフォルト
2. **テンプレート設定** - プロジェクト作成時にテンプレートを読み込んだ場合
3. **保存済みプロジェクト設定** - プロジェクトファイルと共に保存された設定
4. **手動調整** - 現在のセッション中に行った変更

### 設定と画像処理

ほとんどの設定変更（特に「処理」と「エクスポート」カテゴリ）は、新しい設定を反映するために画像の再処理をトリガーします。ただし、一部の設定は「エクスポート専用」であり、即時再処理を必要としません：

* プロジェクトテンプレートの保存
* 作業ディレクトリ
* キャリブレーション済み画像形式（エクスポート時に適用）

***

## ベストプラクティス

1. **デフォルト設定から始める**: デフォルト設定は、ほとんどのMAPIRカメラシステムと標準的なワークフローで良好に機能します。
2. **テンプレートを作成する**: 特定のワークフローやカメラ向けに設定を最適化したら、プロジェクト間で一貫性を保つためテンプレートとして保存してください。
3. **本番処理前のテスト**: 新しい設定を試す際は、全データセットを処理する前に、画像の小さなサブセットでテストしてください。
4. **設定の文書化**: カメラシステム、処理タイプ、使用目的を示す説明的なテンプレート名を使用してください（例: &quot;Survey3\_RGB\_NDVI\_Agriculture&quot;）。
5. **出力形式の選択**: 最終用途に応じて出力形式を選択してください：
   * 科学分析 → TIFF (16ビットまたは32ビット)
   * GIS処理 → TIFF (16ビット)
   * 簡易可視化 → PNG (8ビット)
   * Web共有 → JPG (8ビット)

***

Chlorosにおけるマルチスペクトル指標の詳細については、[マルチスペクトル指標計算式](multispectral-index-formulas.md)ページを参照してください。
